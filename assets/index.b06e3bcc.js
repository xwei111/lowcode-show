import{b as wt}from"./index.2d473fb6.js";const xt="/api/codease",_r=e=>wt(`${xt}/operate/send`,{method:"POST",body:e}),wr=()=>wt(`${xt}/operate/build`),xr=()=>wt(`${xt}/git/submit`),Er=e=>wt(`${xt}/operate/style`,{method:"POST",body:e}),Sr=Object.freeze(Object.defineProperty({__proto__:null,send:_r,build:wr,submit:xr,getStyle:Er},Symbol.toStringTag,{value:"Module"}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var P=function(){return P=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},P.apply(this,arguments)};function Ot(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var M=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,N=Object.keys,W=Array.isArray;typeof Promise<"u"&&!M.Promise&&(M.Promise=Promise);function H(e,t){return typeof t!="object"||N(t).forEach(function(n){e[n]=t[n]}),e}var Le=Object.getPrototypeOf,Ar={}.hasOwnProperty;function Q(e,t){return Ar.call(e,t)}function ke(e,t){typeof t=="function"&&(t=t(Le(e))),(typeof Reflect>"u"?N:Reflect.ownKeys)(t).forEach(function(n){se(e,n,t[n])})}var Bn=Object.defineProperty;function se(e,t,n,r){Bn(e,t,H(n&&Q(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Te(e){return{from:function(t){return e.prototype=Object.create(t.prototype),se(e.prototype,"constructor",e),{extend:ke.bind(null,e.prototype)}}}}var Kr=Object.getOwnPropertyDescriptor;function an(e,t){var n=Kr(e,t),r;return n||(r=Le(e))&&an(r,t)}var Dr=[].slice;function Et(e,t,n){return Dr.call(e,t,n)}function Mn(e,t){return t(e)}function Be(e){if(!e)throw new Error("Assertion Failed")}function Fn(e){M.setImmediate?setImmediate(e):setTimeout(e,0)}function jn(e,t){return e.reduce(function(n,r,i){var a=t(r,i);return a&&(n[a[0]]=a[1]),n},{})}function Cr(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}function oe(e,t){if(Q(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=oe(e,t[r]);n.push(a)}return n}var u=t.indexOf(".");if(u!==-1){var o=e[t.substr(0,u)];return o===void 0?void 0:oe(o,t.substr(u+1))}}function q(e,t,n){if(!(!e||t===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Be(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)q(e,t[r],n[r])}else{var a=t.indexOf(".");if(a!==-1){var u=t.substr(0,a),o=t.substr(a+1);if(o==="")n===void 0?W(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=n;else{var s=e[u];(!s||!Q(e,u))&&(s=e[u]={}),q(s,o,n)}}else n===void 0?W(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function kr(e,t){typeof t=="string"?q(e,t,void 0):"length"in t&&[].map.call(t,function(n){q(e,n,void 0)})}function Nn(e){var t={};for(var n in e)Q(e,n)&&(t[n]=e[n]);return t}var Tr=[].concat;function Ln(e){return Tr.apply([],e)}var Vn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ln([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return M[e]}),Pr=Vn.map(function(e){return M[e]});jn(Vn,function(e){return[e,!0]});var de=null;function Qe(e){de=typeof WeakMap<"u"&&new WeakMap;var t=Bt(e);return de=null,t}function Bt(e){if(!e||typeof e!="object")return e;var t=de&&de.get(e);if(t)return t;if(W(e)){t=[],de&&de.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Bt(e[n]))}else if(Pr.indexOf(e.constructor)>=0)t=e;else{var i=Le(e);t=i===Object.prototype?{}:Object.create(i),de&&de.set(e,t);for(var a in e)Q(e,a)&&(t[a]=Bt(e[a]))}return t}var Ir={}.toString;function Mt(e){return Ir.call(e).slice(8,-1)}var Ft=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Rr=typeof Ft=="symbol"?function(e){var t;return e!=null&&(t=e[Ft])&&t.apply(e)}:function(){return null},De={};function ae(e){var t,n,r,i;if(arguments.length===1){if(W(e))return e.slice();if(this===De&&typeof e=="string")return[e];if(i=Rr(e)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(e==null)return[e];if(t=e.length,typeof t=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var un=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ne=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zn(e,t){ne=e,Wn=t}var Wn=function(){return!0},Or=!new Error("").stack;function Se(){if(Or)try{throw Se.arguments,new Error}catch(e){return e}return new Error}function jt(e,t){var n=e.stack;return n?(t=t||0,n.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),n.split(`
`).slice(t).filter(Wn).map(function(r){return`
`+r}).join("")):""}var Br=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Un=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],on=Br.concat(Un),Mr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Pe(e,t){this._e=Se(),this.name=e,this.message=t}Te(Pe).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+jt(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Hn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function ht(e,t,n,r){this._e=Se(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Hn(e,t)}Te(ht).from(Pe);function Fe(e,t){this._e=Se(),this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Hn(e,t)}Te(Fe).from(Pe);var sn=on.reduce(function(e,t){return e[t]=t+"Error",e},{}),Fr=Pe,C=on.reduce(function(e,t){var n=t+"Error";function r(i,a){this._e=Se(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=Mr[t]||n,this.inner=null)}return Te(r).from(Fr),e[t]=r,e},{});C.Syntax=SyntaxError;C.Type=TypeError;C.Range=RangeError;var xn=Un.reduce(function(e,t){return e[t+"Error"]=C[t],e},{});function jr(e,t){if(!e||e instanceof Pe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!xn[e.name])return e;var n=new xn[e.name](t||e.message,e);return"stack"in e&&se(n,"stack",{get:function(){return this.inner.stack}}),n}var St=on.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=C[t]),e},{});St.ModifyError=ht;St.DexieError=Pe;St.BulkError=Fe;function B(){}function Xe(e){return e}function Nr(e,t){return e==null||e===Xe?t:function(n){return t(e(n))}}function xe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Lr(e,t){return e===B?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?xe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?xe(i,this.onerror):i),a!==void 0?a:n}}function Vr(e,t){return e===B?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?xe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?xe(r,this.onerror):r)}}function zr(e,t){return e===B?t:function(n){var r=e.apply(this,arguments);H(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?xe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?xe(a,this.onerror):a),r===void 0?u===void 0?void 0:u:H(r,u)}}function Wr(e,t){return e===B?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function cn(e,t){return e===B?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}var Ve={},Ur=100,Hr=20,Yn=100,ln=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Le(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Le(t),e]}(),Nt=ln[0],dt=ln[1],Lt=ln[2],Qn=dt&&dt.then,ut=Nt&&Nt.constructor,fn=!!Lt,Vt=!1,Yr=Lt?function(){Lt.then(et)}:M.setImmediate?setImmediate.bind(null,et):M.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){et(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(et,0)},ze=function(e,t){Me.push([e,t]),pt&&(Yr(),pt=!1)},zt=!0,pt=!0,_e=[],ot=[],Wt=null,Ut=Xe,Ce={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:An,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{An(e[0],e[1])}catch(t){}})}},A=Ce,Me=[],we=0,st=[];function S(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=B,this._lib=!1;var t=this._PSD=A;if(ne&&(this._stackHolder=Se(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==Ve)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Yt(this,this._value);return}this._state=null,this._value=null,++t.ref,Gn(this,e)}var Ht={get:function(){var e=A,t=vt;function n(r,i){var a=this,u=!e.global&&(e!==A||t!==vt),o=u&&!ce(),s=new S(function(c,f){hn(a,new Xn(mt(r,e,u,o),mt(i,e,u,o),c,f,e))});return ne&&qn(s,this),s}return n.prototype=Ve,n},set:function(e){se(this,"then",e&&e.prototype===Ve?Ht:{get:function(){return e},set:Ht.set})}};ke(S.prototype,{then:Ht,_then:function(e,t){hn(this,new Xn(null,null,e,t,A))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,function(r){return r instanceof t?n(r):ct(r)}):this.then(null,function(r){return r&&r.name===t?n(r):ct(r)})},finally:function(e){return this.then(function(t){return e(),t},function(t){return e(),ct(t)})},stack:{get:function(){if(this._stack)return this._stack;try{Vt=!0;var e=Jn(this,[],Hr),t=e.join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Vt=!1}}},timeout:function(e,t){var n=this;return e<1/0?new S(function(r,i){var a=setTimeout(function(){return i(new C.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&se(S.prototype,Symbol.toStringTag,"Dexie.Promise");Ce.env=Zn();function Xn(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}ke(S,{all:function(){var e=ae.apply(null,arguments).map(yt);return new S(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return S.resolve(i).then(function(u){e[a]=u,--r||t(e)},n)})})},resolve:function(e){if(e instanceof S)return e;if(e&&typeof e.then=="function")return new S(function(n,r){e.then(n,r)});var t=new S(Ve,!0,e);return qn(t,Wt),t},reject:ct,race:function(){var e=ae.apply(null,arguments).map(yt);return new S(function(t,n){e.map(function(r){return S.resolve(r).then(t,n)})})},PSD:{get:function(){return A},set:function(e){return A=e}},totalEchoes:{get:function(){return vt}},newPSD:ve,usePSD:Re,scheduler:{get:function(){return ze},set:function(e){ze=e}},rejectionMapper:{get:function(){return Ut},set:function(e){Ut=e}},follow:function(e,t){return new S(function(n,r){return ve(function(i,a){var u=A;u.unhandleds=[],u.onunhandled=a,u.finalize=xe(function(){var o=this;Xr(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),e()},t,n,r)})}});ut&&(ut.allSettled&&se(S,"allSettled",function(){var e=ae.apply(null,arguments).map(yt);return new S(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return S.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--n||t(r)})})})}),ut.any&&typeof AggregateError<"u"&&se(S,"any",function(){var e=ae.apply(null,arguments).map(yt);return new S(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,u){return S.resolve(a).then(function(o){return t(o)},function(o){i[u]=o,--r||n(new AggregateError(i))})})})}));function Gn(e,t){try{t(function(n){if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Ge();n&&typeof n.then=="function"?Gn(e,function(i,a){n instanceof S?n._then(i,a):n.then(i,a)}):(e._state=!0,e._value=n,$n(e)),r&&$e()}},Yt.bind(null,e))}catch(n){Yt(e,n)}}function Yt(e,t){if(ot.push(t),e._state===null){var n=e._lib&&Ge();t=Ut(t),e._state=!1,e._value=t,ne&&t!==null&&typeof t=="object"&&!t._promise&&Cr(function(){var r=an(t,"stack");t._promise=e,se(t,"stack",{get:function(){return Vt?r&&(r.get?r.get.apply(t):r.value):e.stack}})}),Gr(e),$n(e),n&&$e()}}function $n(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)hn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),we===0&&(++we,ze(function(){--we===0&&dn()},[]))}function hn(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++we,ze(Qr,[n,e,t])}function Qr(e,t,n){try{Wt=t;var r,i=t._value;t._state?r=e(i):(ot.length&&(ot=[]),r=e(i),ot.indexOf(i)===-1&&$r(t)),n.resolve(r)}catch(a){n.reject(a)}finally{Wt=null,--we===0&&dn(),--n.psd.ref||n.psd.finalize()}}function Jn(e,t,n){if(t.length===n)return t;var r="";if(e._state===!1){var i=e._value,a,u;i!=null?(a=i.name||"Error",u=i.message||i,r=jt(i,0)):(a=i,u=""),t.push(a+(u?": "+u:"")+r)}return ne&&(r=jt(e._stackHolder,2),r&&t.indexOf(r)===-1&&t.push(r),e._prev&&Jn(e._prev,t,n)),t}function qn(e,t){var n=t?t._numPrev+1:0;n<Ur&&(e._prev=t,e._numPrev=n)}function et(){Ge()&&$e()}function Ge(){var e=zt;return zt=!1,pt=!1,e}function $e(){var e,t,n;do for(;Me.length>0;)for(e=Me,Me=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Me.length>0);zt=!0,pt=!0}function dn(){var e=_e;_e=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=st.slice(0),n=t.length;n;)t[--n]()}function Xr(e){function t(){e(),st.splice(st.indexOf(t),1)}st.push(t),++we,ze(function(){--we===0&&dn()},[])}function Gr(e){_e.some(function(t){return t._value===e._value})||_e.push(e)}function $r(e){for(var t=_e.length;t;)if(_e[--t]._value===e._value){_e.splice(t,1);return}}function ct(e){return new S(Ve,!1,e)}function F(e,t){var n=A;return function(){var r=Ge(),i=A;try{return ye(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{ye(i,!1),r&&$e()}}}var z={awaits:0,echoes:0,id:0},Jr=0,lt=[],Dt=0,vt=0,qr=0;function ve(e,t,n,r){var i=A,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++qr;var u=Ce.env;a.env=fn?{Promise:S,PromiseProp:{value:S,configurable:!0,writable:!0},all:S.all,race:S.race,allSettled:S.allSettled,any:S.any,resolve:S.resolve,reject:S.reject,nthen:En(u.nthen,a),gthen:En(u.gthen,a)}:{},t&&H(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Re(a,e,n,r);return a.ref===0&&a.finalize(),o}function Ie(){return z.id||(z.id=++Jr),++z.awaits,z.echoes+=Yn,z.id}function ce(){return z.awaits?(--z.awaits===0&&(z.id=0),z.echoes=z.awaits*Yn,!0):!1}(""+Qn).indexOf("[native code]")===-1&&(Ie=ce=B);function yt(e){return z.echoes&&e&&e.constructor===ut?(Ie(),e.then(function(t){return ce(),t},function(t){return ce(),L(t)})):e}function Zr(e){++vt,(!z.echoes||--z.echoes===0)&&(z.echoes=z.id=0),lt.push(A),ye(e,!0)}function ei(){var e=lt[lt.length-1];lt.pop(),ye(e,!1)}function ye(e,t){var n=A;if((t?z.echoes&&(!Dt++||e!==A):Dt&&(!--Dt||e!==A))&&er(t?Zr.bind(null,e):ei),e!==A&&(A=e,n===Ce&&(Ce.env=Zn()),fn)){var r=Ce.env.Promise,i=e.env;dt.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(M,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Zn(){var e=M.Promise;return fn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(M,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:dt.then,gthen:e.prototype.then}:{}}function Re(e,t,n,r,i){var a=A;try{return ye(e,!0),t(n,r,i)}finally{ye(a,!1)}}function er(e){Qn.call(Nt,e)}function mt(e,t,n,r){return typeof e!="function"?e:function(){var i=A;n&&Ie(),ye(t,!0);try{return e.apply(this,arguments)}finally{ye(i,!1),r&&er(ce)}}}function En(e,t){return function(n,r){return e.call(this,mt(n,t),mt(r,t))}}var Sn="unhandledrejection";function An(e,t){var n;try{n=t.onuncatched(e)}catch(a){}if(n!==!1)try{var r,i={promise:t,reason:e};if(M.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Sn,!0,!0),H(r,i)):M.CustomEvent&&(r=new CustomEvent(Sn,{detail:i}),H(r,i)),r&&M.dispatchEvent&&(dispatchEvent(r),!M.PromiseRejectionEvent&&M.onunhandledrejection))try{M.onunhandledrejection(r)}catch(a){}ne&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(a){}}var L=S.reject;function Qt(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!A.letThrough&&!e._vip){if(e._state.openComplete)return L(new C.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return L(new C.DatabaseClosed);e.open().catch(B)}return e._state.dbReadyPromise.then(function(){return Qt(e,t,n,r)})}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(a){return a.name===sn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return Qt(e,t,n,r)})):L(a)}return i._promise(t,function(a,u){return ve(function(){return A.trans=i,r(a,u,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var Kn="3.2.4",be=String.fromCharCode(65535),Xt=-1/0,re="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",tr="String expected.",je=[],At=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ti=At,ni=At,nr=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},Kt="__dbnames",Ct="readonly",kt="readwrite";function Ee(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var rr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tt(e){return typeof e=="string"&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=Qe(t),delete t[e]),t}:function(t){return t}}var ri=function(){function e(){}return e.prototype._trans=function(t,n,r){var i=this._tx||A.trans,a=this.name;function u(s,c,f){if(!f.schema[a])throw new C.NotFound("Table "+a+" not part of transaction");return n(f.idbtrans,f)}var o=Ge();try{return i&&i.db===this.db?i===A.trans?i._promise(t,u,r):ve(function(){return i._promise(t,u,r)},{trans:i,transless:A.transless||A}):Qt(this.db,t,[this.name],u)}finally{o&&$e()}},e.prototype.get=function(t,n){var r=this;return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:t}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},e.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(W(t))return new this.db.WhereClause(this,"["+t.join("+")+"]");var n=N(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(f){return f.compound&&n.every(function(l){return f.keyPath.indexOf(l)>=0})&&f.keyPath.every(function(l){return n.indexOf(l)>=0})})[0];if(r&&this.db._maxKey!==be)return this.where(r.name).equals(r.keyPath.map(function(f){return t[f]}));!r&&ne&&console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,a=this.db._deps.indexedDB;function u(f,l){try{return a.cmp(f,l)===0}catch(h){return!1}}var o=n.reduce(function(f,l){var h=f[0],x=f[1],p=i[l],d=t[l];return[h||p,h||!p?Ee(x,p&&p.multi?function(y){var _=oe(y,l);return W(_)&&_.some(function(m){return u(d,m)})}:function(y){return u(d,oe(y,l))}):x]},[null,null]),s=o[0],c=o[1];return s?this.where(s.name).equals(t[s.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")},e.prototype.filter=function(t){return this.toCollection().and(t)},e.prototype.count=function(t){return this.toCollection().count(t)},e.prototype.offset=function(t){return this.toCollection().offset(t)},e.prototype.limit=function(t){return this.toCollection().limit(t)},e.prototype.each=function(t){return this.toCollection().each(t)},e.prototype.toArray=function(t){return this.toCollection().toArray(t)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,W(t)?"["+t.join("+")+"]":t))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(t){this.schema.mappedClass=t;var n=function(r){if(!r)return r;var i=Object.create(t.prototype);for(var a in r)if(Q(r,a))try{i[a]=r[a]}catch(u){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t},e.prototype.defineClass=function(){function t(n){H(this,n)}return this.mapToClass(t)},e.prototype.add=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=t;return u&&a&&(o=tt(u)(t)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:n!=null?[n]:null,values:[o]})}).then(function(s){return s.numFailures?S.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{q(t,u,s)}catch(c){}return s})},e.prototype.update=function(t,n){if(typeof t=="object"&&!W(t)){var r=oe(t,this.schema.primKey.keyPath);if(r===void 0)return L(new C.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?N(n).forEach(function(i){q(t,i,n[i])}):n(t,{value:t,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(t).modify(n)},e.prototype.put=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=t;return u&&a&&(o=tt(u)(t)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:n!=null?[n]:null})}).then(function(s){return s.numFailures?S.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{q(t,u,s)}catch(c){}return s})},e.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[t]})}).then(function(r){return r.numFailures?S.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"deleteRange",range:rr})}).then(function(n){return n.numFailures?S.reject(n.failures[0]):void 0})},e.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:t,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},e.prototype.bulkAdd=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=t.length,h=f&&c?t.map(tt(f)):t;return i.core.mutate({trans:o,type:"add",keys:a,values:h,wantResults:u}).then(function(x){var p=x.numFailures,d=x.results,y=x.lastResult,_=x.failures,m=u?d:y;if(p===0)return m;throw new Fe(i.name+".bulkAdd(): "+p+" of "+l+" operations failed",_)})})},e.prototype.bulkPut=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=t.length,h=f&&c?t.map(tt(f)):t;return i.core.mutate({trans:o,type:"put",keys:a,values:h,wantResults:u}).then(function(x){var p=x.numFailures,d=x.results,y=x.lastResult,_=x.failures,m=u?d:y;if(p===0)return m;throw new Fe(i.name+".bulkPut(): "+p+" of "+l+" operations failed",_)})})},e.prototype.bulkDelete=function(t){var n=this,r=t.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:t})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Fe(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",o)})},e}();function Je(e){var t={},n=function(o,s){if(s){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return t[o].subscribe.apply(null,f),e}else if(typeof o=="string")return t[o]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=Wr),c||(c=B);var f={subscribers:[],fire:c,subscribe:function(l){f.subscribers.indexOf(l)===-1&&(f.subscribers.push(l),f.fire=s(f.fire,l))},unsubscribe:function(l){f.subscribers=f.subscribers.filter(function(h){return h!==l}),f.fire=f.subscribers.reduce(s,c)}};return t[o]=n[o]=f,f}function u(o){N(o).forEach(function(s){var c=o[s];if(W(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var f=a(s,Xe,function(){for(var h=arguments.length,x=new Array(h);h--;)x[h]=arguments[h];f.subscribers.forEach(function(p){Fn(function(){p.apply(null,x)})})});else throw new C.InvalidArgument("Invalid event config")})}}function qe(e,t){return Te(t).from({prototype:e}),t}function ii(e){return qe(ri.prototype,function(n,r,i){this.db=e,this._tx=i,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:Je(null,{creating:[Lr,B],reading:[Nr,Xe],updating:[zr,B],deleting:[Vr,B]})})}function Ae(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Tt(e,t){e.filter=Ee(e.filter,t)}function Pt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ee(r(),t())}:t,e.justLimit=n&&!r}function ai(e,t){e.isMatch=Ee(e.isMatch,t)}function ft(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new C.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Dn(e,t,n){var r=ft(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function nt(e,t,n,r){var i=e.replayFilter?Ee(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(h){return s.stop(h)},function(h){return s.fail(h)})){var f=s.primaryKey,l=""+f;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(f)),Q(a,l)||(a[l]=!0,t(o,s,c))}};return Promise.all([e.or._iterate(u,n),Cn(Dn(e,r,n),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}else return Cn(Dn(e,r,n),Ee(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Cn(e,t,n,r){var i=r?function(u,o,s){return n(r(u),o,s)}:n,a=F(i);return e.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!t||t(u,function(s){return o=s},function(s){u.stop(s),o=B},function(s){u.fail(s),o=B}))&&a(u.value,u,function(s){return o=s}),o()})})}function U(e,t){try{var n=kn(e),r=kn(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return oi(Tn(e),Tn(t));case"Array":return ui(e,t)}}catch(i){}return NaN}function ui(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var u=U(e[a],t[a]);if(u!==0)return u}return n===r?0:n<r?-1:1}function oi(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}function kn(e){var t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";var n=Mt(e);return n==="ArrayBuffer"?"binary":n}function Tn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var si=function(){function e(){}return e.prototype._read=function(t,n){var r=this._ctx;return r.error?r.table._trans(null,L.bind(null,r.error)):r.table._trans("readonly",t).then(n)},e.prototype._write=function(t){var n=this._ctx;return n.error?n.table._trans(null,L.bind(null,n.error)):n.table._trans("readwrite",t,"locked")},e.prototype._addAlgorithm=function(t){var n=this._ctx;n.algorithm=Ee(n.algorithm,t)},e.prototype._iterate=function(t,n){return nt(this._ctx,t,n,this._ctx.table.core)},e.prototype.clone=function(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&H(r,t),n._ctx=r,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(t){var n=this._ctx;return this._read(function(r){return nt(n,t,r,n.table.core)})},e.prototype.count=function(t){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(Ae(i,!0))return a.count({trans:r,query:{index:ft(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return nt(i,function(){return++u,!1},r,a).then(function(){return u})}).then(t)},e.prototype.sortBy=function(t,n){var r=t.split(".").reverse(),i=r[0],a=r.length-1;function u(c,f){return f?u(c[r[f]],f-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,f){var l=u(c,a),h=u(f,a);return l<h?-o:l>h?o:0}return this.toArray(function(c){return c.sort(s)}).then(n)},e.prototype.toArray=function(t){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&Ae(i,!0)&&i.limit>0){var a=i.valueMapper,u=ft(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return nt(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},t)},e.prototype.offset=function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,Ae(n)?Pt(n,function(){var r=t;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Pt(n,function(){var r=t;return function(){return--r<0}}),this)},e.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Pt(this._ctx,function(){var n=t;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},e.prototype.until=function(t,n){return Tt(this._ctx,function(r,i,a){return t(r.value)?(i(a),n):!0}),this},e.prototype.first=function(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)},e.prototype.last=function(t){return this.reverse().first(t)},e.prototype.filter=function(t){return Tt(this._ctx,function(n){return t(n.value)}),ai(this._ctx,t),this},e.prototype.and=function(t){return this.filter(t)},e.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})},e.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},e.prototype.eachPrimaryKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})},e.prototype.keys=function(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(t)},e.prototype.primaryKeys=function(t){var n=this._ctx;if(n.dir==="next"&&Ae(n,!0)&&n.limit>0)return this._read(function(i){var a=ft(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(t)},e.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},e.prototype.firstKey=function(t){return this.limit(1).keys(function(n){return n[0]}).then(t)},e.prototype.lastKey=function(t){return this.reverse().firstKey(t)},e.prototype.distinct=function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return Tt(this._ctx,function(i){var a=i.primaryKey.toString(),u=Q(r,a);return r[a]=!0,!u}),this},e.prototype.modify=function(t){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof t=="function")a=t;else{var u=N(t),o=u.length;a=function(_){for(var m=!1,g=0;g<o;++g){var b=u[g],v=t[b];oe(_,b)!==v&&(q(_,b,v),m=!0)}return m}}var s=r.table.core,c=s.schema.primaryKey,f=c.outbound,l=c.extractKey,h=n.db._options.modifyChunkSize||200,x=[],p=0,d=[],y=function(_,m){var g=m.failures,b=m.numFailures;p+=_-b;for(var v=0,w=N(g);v<w.length;v++){var K=w[v];x.push(g[K])}};return n.clone().primaryKeys().then(function(_){var m=function(g){var b=Math.min(h,_.length-g);return s.getMany({trans:i,keys:_.slice(g,g+b),cache:"immutable"}).then(function(v){for(var w=[],K=[],E=f?[]:null,D=[],k=0;k<b;++k){var R=v[k],O={value:Qe(R),primKey:_[g+k]};a.call(O,O.value,O)!==!1&&(O.value==null?D.push(_[g+k]):!f&&U(l(R),l(O.value))!==0?(D.push(_[g+k]),w.push(O.value)):(K.push(O.value),f&&E.push(_[g+k])))}var I=Ae(r)&&r.limit===1/0&&(typeof t!="function"||t===It)&&{index:r.index,range:r.range};return Promise.resolve(w.length>0&&s.mutate({trans:i,type:"add",values:w}).then(function(V){for(var T in V.failures)D.splice(parseInt(T),1);y(w.length,V)})).then(function(){return(K.length>0||I&&typeof t=="object")&&s.mutate({trans:i,type:"put",keys:E,values:K,criteria:I,changeSpec:typeof t!="function"&&t}).then(function(V){return y(K.length,V)})}).then(function(){return(D.length>0||I&&t===It)&&s.mutate({trans:i,type:"delete",keys:D,criteria:I}).then(function(V){return y(D.length,V)})}).then(function(){return _.length>g+b&&m(g+h)})})};return m(0).then(function(){if(x.length>0)throw new ht("Error modifying one or more objects",x,p,d);return _.length})})})},e.prototype.delete=function(){var t=this._ctx,n=t.range;return Ae(t)&&(t.isPrimKey&&!ni||n.type===3)?this._write(function(r){var i=t.table.core.schema.primaryKey,a=n;return t.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return t.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new ht("Could not delete some values",Object.keys(s).map(function(f){return s[f]}),u-c);return u-c})})}):this.modify(It)},e}(),It=function(e,t){return t.value=null};function ci(e){return qe(si.prototype,function(n,r){this.db=e;var i=rr,a=null;if(r)try{i=r()}catch(c){a=c}var u=n._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==Xe?s:null}})}function li(e,t){return e<t?-1:e===t?0:1}function fi(e,t){return e>t?-1:e===t?0:1}function Y(e,t,n){var r=e instanceof ar?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Ke(e){return new e.Collection(e,function(){return ir("")}).limit(0)}function hi(e){return e==="next"?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function di(e){return e==="next"?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function pi(e,t,n,r,i,a){for(var u=Math.min(e.length,r.length),o=-1,s=0;s<u;++s){var c=t[s];if(c!==r[s])return i(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):o>=0?e.substr(0,o)+t[o]+n.substr(o+1):null;i(e[s],c)<0&&(o=s)}return u<r.length&&a==="next"?e+n.substr(e.length):u<e.length&&a==="prev"?e.substr(0,n.length):o<0?null:e.substr(0,o)+r[o]+n.substr(o+1)}function rt(e,t,n,r){var i,a,u,o,s,c,f,l=n.length;if(!n.every(function(d){return typeof d=="string"}))return Y(e,tr);function h(d){i=hi(d),a=di(d),u=d==="next"?li:fi;var y=n.map(function(_){return{lower:a(_),upper:i(_)}}).sort(function(_,m){return u(_.lower,m.lower)});o=y.map(function(_){return _.upper}),s=y.map(function(_){return _.lower}),c=d,f=d==="next"?"":r}h("next");var x=new e.Collection(e,function(){return he(o[0],s[l-1]+r)});x._ondirectionchange=function(d){h(d)};var p=0;return x._addAlgorithm(function(d,y,_){var m=d.key;if(typeof m!="string")return!1;var g=a(m);if(t(g,s,p))return!0;for(var b=null,v=p;v<l;++v){var w=pi(m,g,o[v],s[v],u,c);w===null&&b===null?p=v+1:(b===null||u(b,w)>0)&&(b=w)}return y(b!==null?function(){d.continue(b+f)}:_),!1}),x}function he(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ir(e){return{type:1,lower:e,upper:e}}var ar=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&!(r&&i)?Ke(this):new this.Collection(this,function(){return he(t,n,!r,!i)})}catch(a){return Y(this,re)}},e.prototype.equals=function(t){return t==null?Y(this,re):new this.Collection(this,function(){return ir(t)})},e.prototype.above=function(t){return t==null?Y(this,re):new this.Collection(this,function(){return he(t,void 0,!0)})},e.prototype.aboveOrEqual=function(t){return t==null?Y(this,re):new this.Collection(this,function(){return he(t,void 0,!1)})},e.prototype.below=function(t){return t==null?Y(this,re):new this.Collection(this,function(){return he(void 0,t,!1,!0)})},e.prototype.belowOrEqual=function(t){return t==null?Y(this,re):new this.Collection(this,function(){return he(void 0,t)})},e.prototype.startsWith=function(t){return typeof t!="string"?Y(this,tr):this.between(t,t+be,!0,!0)},e.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):rt(this,function(n,r){return n.indexOf(r[0])===0},[t],be)},e.prototype.equalsIgnoreCase=function(t){return rt(this,function(n,r){return n===r[0]},[t],"")},e.prototype.anyOfIgnoreCase=function(){var t=ae.apply(De,arguments);return t.length===0?Ke(this):rt(this,function(n,r){return r.indexOf(n)!==-1},t,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var t=ae.apply(De,arguments);return t.length===0?Ke(this):rt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},t,be)},e.prototype.anyOf=function(){var t=this,n=ae.apply(De,arguments),r=this._cmp;try{n.sort(r)}catch(u){return Y(this,re)}if(n.length===0)return Ke(this);var i=new this.Collection(this,function(){return he(n[0],n[n.length-1])});i._ondirectionchange=function(u){r=u==="next"?t._ascending:t._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,n[a])>0;)if(++a,a===n.length)return o(s),!1;return r(c,n[a])===0?!0:(o(function(){u.continue(n[a])}),!1)}),i},e.prototype.notEqual=function(t){return this.inAnyRange([[Xt,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var t=ae.apply(De,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch(r){return Y(this,re)}var n=t.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Xt,i]]},null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(t,n){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(t.length===0)return Ke(this);if(!t.every(function(v){return v[0]!==void 0&&v[1]!==void 0&&a(v[0],v[1])<=0}))return Y(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",C.InvalidArgument);var c=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0;function l(v,w){for(var K=0,E=v.length;K<E;++K){var D=v[K];if(i(w[0],D[1])<0&&i(w[1],D[0])>0){D[0]=o(D[0],w[0]),D[1]=s(D[1],w[1]);break}}return K===E&&v.push(w),v}var h=a;function x(v,w){return h(v[0],w[0])}var p;try{p=t.reduce(l,[]),p.sort(x)}catch(v){return Y(this,re)}var d=0,y=f?function(v){return a(v,p[d][1])>0}:function(v){return a(v,p[d][1])>=0},_=c?function(v){return u(v,p[d][0])>0}:function(v){return u(v,p[d][0])>=0};function m(v){return!y(v)&&!_(v)}var g=y,b=new this.Collection(this,function(){return he(p[0][0],p[p.length-1][1],!c,!f)});return b._ondirectionchange=function(v){v==="next"?(g=y,h=a):(g=_,h=u),p.sort(x)},b._addAlgorithm(function(v,w,K){for(var E=v.key;g(E);)if(++d,d===p.length)return w(K),!1;return m(E)?!0:(r._cmp(E,p[d][1])===0||r._cmp(E,p[d][0])===0||w(function(){h===a?v.continue(p[d][0]):v.continue(p[d][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var t=ae.apply(De,arguments);return t.every(function(n){return typeof n=="string"})?t.length===0?Ke(this):this.inAnyRange(t.map(function(n){return[n,n+be]})):Y(this,"startsWithAnyOf() only works with strings")},e}();function vi(e){return qe(ar.prototype,function(n,r,i){this.db=e,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=e._deps.indexedDB;if(!a)throw new C.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(u,o){return a.cmp(o,u)},this._max=function(u,o){return a.cmp(u,o)>0?u:o},this._min=function(u,o){return a.cmp(u,o)<0?u:o},this._IDBKeyRange=e._deps.IDBKeyRange})}function te(e){return F(function(t){return We(t),e(t.target.error),!1})}function We(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Ue="storagemutated",pe="x-storagemutated-1",me=Je(null,Ue),yi=function(){function e(){}return e.prototype._lock=function(){return Be(!A.global),++this._reculock,this._reculock===1&&!A.global&&(A.lockOwnerFor=this),this},e.prototype._unlock=function(){if(Be(!A.global),--this._reculock===0)for(A.global||(A.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Re(t[1],t[0])}catch(n){}}return this},e.prototype._locked=function(){return this._reculock&&A.lockOwnerFor!==this},e.prototype.create=function(t){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Be(!this.idbtrans),!t&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new C.DatabaseClosed(i);case"MissingAPIError":throw new C.MissingAPI(i.message,i);default:throw new C.OpenFailed(i)}if(!this.active)throw new C.TransactionInactive;return Be(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=F(function(a){We(a),n._reject(t.error)}),t.onabort=F(function(a){We(a),n.active&&n._reject(new C.Abort(t.error)),n.active=!1,n.on("abort").fire(a)}),t.oncomplete=F(function(){n.active=!1,n._resolve(),"mutatedParts"in t&&me.storagemutated.fire(t.mutatedParts)}),this},e.prototype._promise=function(t,n,r){var i=this;if(t==="readwrite"&&this.mode!=="readwrite")return L(new C.ReadOnly("Transaction is readonly"));if(!this.active)return L(new C.TransactionInactive);if(this._locked())return new S(function(u,o){i._blockedFuncs.push([function(){i._promise(t,n,r).then(u,o)},A])});if(r)return ve(function(){var u=new S(function(o,s){i._lock();var c=n(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new S(function(u,o){var s=n(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(t){var n=this._root(),r=S.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=n._waitingFor;return new S(function(u,o){r.then(function(s){return n._waitingQueue.push(F(u.bind(null,s)))},function(s){return n._waitingQueue.push(F(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new C.Abort))},e.prototype.table=function(t){var n=this._memoizedTables||(this._memoizedTables={});if(Q(n,t))return n[t];var r=this.schema[t];if(!r)throw new C.NotFound("Table "+t+" not part of transaction");var i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i},e}();function mi(e){return qe(yi.prototype,function(n,r,i,a,u){var o=this;this.db=e,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=Je(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new S(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),L(s)})})}function Gt(e,t,n,r,i,a,u){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!u?"&":"")+(r?"*":"")+(i?"++":"")+ur(t)}}function ur(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function or(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:jn(n,function(r){return[r.name,r]})}}function gi(e){return e.length===1?e[0]:e}var He=function(e){try{return e.only([[]]),He=function(){return[[]]},[[]]}catch(t){return He=function(){return be},be}};function $t(e){return e==null?function(){}:typeof e=="string"?bi(e):function(t){return oe(t,e)}}function bi(e){var t=e.split(".");return t.length===1?function(n){return n[e]}:function(n){return oe(n,e)}}function Pn(e){return[].slice.call(e)}var _i=0;function Ne(e){return e==null?":id":typeof e=="string"?e:"["+e.join("+")+"]"}function wi(e,t,n){function r(l,h){var x=Pn(l.objectStoreNames);return{schema:{name:l.name,tables:x.map(function(p){return h.objectStore(p)}).map(function(p){var d=p.keyPath,y=p.autoIncrement,_=W(d),m=d==null,g={},b={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:_,keyPath:d,autoIncrement:y,unique:!0,extractKey:$t(d)},indexes:Pn(p.indexNames).map(function(v){return p.index(v)}).map(function(v){var w=v.name,K=v.unique,E=v.multiEntry,D=v.keyPath,k=W(D),R={name:w,compound:k,keyPath:D,unique:K,multiEntry:E,extractKey:$t(D)};return g[Ne(D)]=R,R}),getIndexByKeyPath:function(v){return g[Ne(v)]}};return g[":id"]=b.primaryKey,d!=null&&(g[Ne(d)]=b.primaryKey),b})},hasGetAll:x.length>0&&"getAll"in h.objectStore(x[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var h=l.lower,x=l.upper,p=l.lowerOpen,d=l.upperOpen,y=h===void 0?x===void 0?null:t.upperBound(x,!!d):x===void 0?t.lowerBound(h,!!p):t.bound(h,x,!!p,!!d);return y}function a(l){var h=l.name;function x(y){var _=y.trans,m=y.type,g=y.keys,b=y.values,v=y.range;return new Promise(function(w,K){w=F(w);var E=_.objectStore(h),D=E.keyPath==null,k=m==="put"||m==="add";if(!k&&m!=="delete"&&m!=="deleteRange")throw new Error("Invalid operation type: "+m);var R=(g||b||{length:1}).length;if(g&&b&&g.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return w({numFailures:0,failures:{},results:[],lastResult:void 0});var O,I=[],V=[],T=0,X=function(ee){++T,We(ee)};if(m==="deleteRange"){if(v.type===4)return w({numFailures:T,failures:V,results:[],lastResult:void 0});v.type===3?I.push(O=E.clear()):I.push(O=E.delete(i(v)))}else{var $=k?D?[b,g]:[b,null]:[g,null],le=$[0],Z=$[1];if(k)for(var G=0;G<R;++G)I.push(O=Z&&Z[G]!==void 0?E[m](le[G],Z[G]):E[m](le[G])),O.onerror=X;else for(var G=0;G<R;++G)I.push(O=E[m](le[G])),O.onerror=X}var fe=function(ee){var Oe=ee.target.result;I.forEach(function(J,Ze){return J.error!=null&&(V[Ze]=J.error)}),w({numFailures:T,failures:V,results:m==="delete"?g:I.map(function(J){return J.result}),lastResult:Oe})};O.onerror=function(ee){X(ee),fe(ee)},O.onsuccess=fe})}function p(y){var _=y.trans,m=y.values,g=y.query,b=y.reverse,v=y.unique;return new Promise(function(w,K){w=F(w);var E=g.index,D=g.range,k=_.objectStore(h),R=E.isPrimaryKey?k:k.index(E.name),O=b?v?"prevunique":"prev":v?"nextunique":"next",I=m||!("openKeyCursor"in R)?R.openCursor(i(D),O):R.openKeyCursor(i(D),O);I.onerror=te(K),I.onsuccess=F(function(V){var T=I.result;if(!T){w(null);return}T.___id=++_i,T.done=!1;var X=T.continue.bind(T),$=T.continuePrimaryKey;$&&($=$.bind(T));var le=T.advance.bind(T),Z=function(){throw new Error("Cursor not started")},G=function(){throw new Error("Cursor not stopped")};T.trans=_,T.stop=T.continue=T.continuePrimaryKey=T.advance=Z,T.fail=F(K),T.next=function(){var fe=this,ee=1;return this.start(function(){return ee--?fe.continue():fe.stop()}).then(function(){return fe})},T.start=function(fe){var ee=new Promise(function(J,Ze){J=F(J),I.onerror=te(Ze),T.fail=Ze,T.stop=function(br){T.stop=T.continue=T.continuePrimaryKey=T.advance=G,J(br)}}),Oe=function(){if(I.result)try{fe()}catch(J){T.fail(J)}else T.done=!0,T.start=function(){throw new Error("Cursor behind last entry")},T.stop()};return I.onsuccess=F(function(J){I.onsuccess=Oe,Oe()}),T.continue=X,T.continuePrimaryKey=$,T.advance=le,Oe(),ee},w(T)},K)})}function d(y){return function(_){return new Promise(function(m,g){m=F(m);var b=_.trans,v=_.values,w=_.limit,K=_.query,E=w===1/0?void 0:w,D=K.index,k=K.range,R=b.objectStore(h),O=D.isPrimaryKey?R:R.index(D.name),I=i(k);if(w===0)return m({result:[]});if(y){var V=v?O.getAll(I,E):O.getAllKeys(I,E);V.onsuccess=function(le){return m({result:le.target.result})},V.onerror=te(g)}else{var T=0,X=v||!("openKeyCursor"in O)?O.openCursor(I):O.openKeyCursor(I),$=[];X.onsuccess=function(le){var Z=X.result;if(!Z)return m({result:$});if($.push(v?Z.value:Z.primaryKey),++T===w)return m({result:$});Z.continue()},X.onerror=te(g)}})}}return{name:h,schema:l,mutate:x,getMany:function(y){var _=y.trans,m=y.keys;return new Promise(function(g,b){g=F(g);for(var v=_.objectStore(h),w=m.length,K=new Array(w),E=0,D=0,k,R=function(T){var X=T.target;(K[X._pos]=X.result)!=null,++D===E&&g(K)},O=te(b),I=0;I<w;++I){var V=m[I];V!=null&&(k=v.get(m[I]),k._pos=I,k.onsuccess=R,k.onerror=O,++E)}E===0&&g(K)})},get:function(y){var _=y.trans,m=y.key;return new Promise(function(g,b){g=F(g);var v=_.objectStore(h),w=v.get(m);w.onsuccess=function(K){return g(K.target.result)},w.onerror=te(b)})},query:d(s),openCursor:p,count:function(y){var _=y.query,m=y.trans,g=_.index,b=_.range;return new Promise(function(v,w){var K=m.objectStore(h),E=g.isPrimaryKey?K:K.index(g.name),D=i(b),k=D?E.count(D):E.count();k.onsuccess=F(function(R){return v(R.target.result)}),k.onerror=te(w)})}}}var u=r(e,n),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),f={};return c.forEach(function(l){return f[l.name]=l}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(l){var h=f[l];if(!h)throw new Error("Table '"+l+"' not found");return f[l]},MIN_KEY:-1/0,MAX_KEY:He(t),schema:o}}function xi(e,t){return t.reduce(function(n,r){var i=r.create;return P(P({},n),i(n))},e)}function Ei(e,t,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=xi(wi(t,i,r),e.dbcore);return{dbcore:a}}function pn(e,t){var n=e._novip,r=t.db,i=Ei(n._middlewares,r,n._deps,t);n.core=i.dbcore,n.tables.forEach(function(a){var u=a.name;n.core.schema.tables.some(function(o){return o.name===u})&&(a.core=n.core.table(u),n[u]instanceof n.Table&&(n[u].core=a.core))})}function gt(e,t,n,r){var i=e._novip;n.forEach(function(a){var u=r[a];t.forEach(function(o){var s=an(o,a);(!s||"value"in s&&s.value===void 0)&&(o===i.Transaction.prototype||o instanceof i.Transaction?se(o,a,{get:function(){return this.table(a)},set:function(c){Bn(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new i.Table(a,u))})})}function Jt(e,t){var n=e._novip;t.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function Si(e,t){return e._cfg.version-t._cfg.version}function Ai(e,t,n,r){var i=e._dbSchema,a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var u=a._reject.bind(a),o=A.transless||A;ve(function(){A.trans=a,A.transless=o,t===0?(N(i).forEach(function(s){vn(n,s,i[s].primKey,i[s].indexes)}),pn(e,n),S.follow(function(){return e.on.populate.fire(a)}).catch(u)):Ki(e,t,a,n).catch(u)})}function Ki(e,t,n,r){var i=e._novip,a=[],u=i._versions,o=i._dbSchema=yn(i,i.idbdb,r),s=!1,c=u.filter(function(l){return l._cfg.version>=t});c.forEach(function(l){a.push(function(){var h=o,x=l._cfg.dbschema;Zt(i,h,r),Zt(i,x,r),o=i._dbSchema=x;var p=sr(h,x);p.add.forEach(function(b){vn(r,b[0],b[1].primKey,b[1].indexes)}),p.change.forEach(function(b){if(b.recreate)throw new C.Upgrade("Not yet support for changing primary key");var v=r.objectStore(b.name);b.add.forEach(function(w){return qt(v,w)}),b.change.forEach(function(w){v.deleteIndex(w.name),qt(v,w)}),b.del.forEach(function(w){return v.deleteIndex(w)})});var d=l._cfg.contentUpgrade;if(d&&l._cfg.version>t){pn(i,r),n._memoizedTables={},s=!0;var y=Nn(x);p.del.forEach(function(b){y[b]=h[b]}),Jt(i,[i.Transaction.prototype]),gt(i,[i.Transaction.prototype],N(y),y),n.schema=y;var _=un(d);_&&Ie();var m,g=S.follow(function(){if(m=d(n),m&&_){var b=ce.bind(null,null);m.then(b,b)}});return m&&typeof m.then=="function"?S.resolve(m):g.then(function(){return m})}}),a.push(function(h){if(!s||!ti){var x=l._cfg.dbschema;Ci(x,h)}Jt(i,[i.Transaction.prototype]),gt(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function f(){return a.length?S.resolve(a.shift()(n.idbtrans)).then(f):S.resolve()}return f().then(function(){Di(o,r)})}function sr(e,t){var n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],a=t[r];if(!i)n.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!At)u.recreate=!0,n.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var f=o[c],l=s[c];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}}return n}function vn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return qt(i,a)}),i}function Di(e,t){N(e).forEach(function(n){t.db.objectStoreNames.contains(n)||vn(t,n,e[n].primKey,e[n].indexes)})}function Ci(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function qt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yn(e,t,n){var r={},i=Et(t.objectStoreNames,0);return i.forEach(function(a){for(var u=n.objectStore(a),o=u.keyPath,s=Gt(ur(o),o||"",!1,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],f=0;f<u.indexNames.length;++f){var l=u.index(u.indexNames[f]);o=l.keyPath;var h=Gt(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(h)}r[a]=or(a,s,c)}),r}function ki(e,t,n){var r=e._novip;r.verno=t.version/10;var i=r._dbSchema=yn(r,t,n);r._storeNames=Et(t.objectStoreNames,0),gt(r,[r._allTables],N(i),i)}function Ti(e,t){var n=yn(e,e.idbdb,t),r=sr(n,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function Zt(e,t,n){for(var r=e._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var u=i[a],o=n.objectStore(u);r._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],f=o.index(c).keyPath,l=typeof f=="string"?f:"["+Et(f).join("+")+"]";if(t[u]){var h=t[u].idxByName[l];h&&(h.name=c,delete t[u].idxByName[l],t[u].idxByName[c]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&M.WorkerGlobalScope&&M instanceof M.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Pi(e){return e.split(",").map(function(t,n){t=t.trim();var r=t.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Gt(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),W(i),n===0)})}var Ii=function(){function e(){}return e.prototype._parseStoresSpec=function(t,n){N(t).forEach(function(r){if(t[r]!==null){var i=Pi(t[r]),a=i.shift();if(a.multi)throw new C.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new C.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new C.Schema("Index must have a name and cannot be an empty string")}),n[r]=or(r,a,i)}})},e.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?H(this._cfg.storesSource,t):t;var r=n._versions,i={},a={};return r.forEach(function(u){H(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),n._dbSchema=a,Jt(n,[n._allTables,n,n.Transaction.prototype]),gt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],N(a),a),n._storeNames=N(a),this},e.prototype.upgrade=function(t){return this._cfg.contentUpgrade=cn(this._cfg.contentUpgrade||B,t),this},e}();function Ri(e){return qe(Ii.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function mn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new wn(Kt,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function gn(e){return e&&typeof e.databases=="function"}function Oi(e){var t=e.indexedDB,n=e.IDBKeyRange;return gn(t)?Promise.resolve(t.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Kt})}):mn(t,n).toCollection().primaryKeys()}function Bi(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!gn(n)&&t!==Kt&&mn(n,r).put({name:t}).catch(B)}function Mi(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!gn(n)&&t!==Kt&&mn(n,r).delete(t).catch(B)}function en(e){return ve(function(){return A.letThrough=!0,e()})}function Fi(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)})}function ji(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?L(t.dbOpenError):e});ne&&(t.openCanceller._stackHolder=Se()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new C.DatabaseClosed("db.open() was cancelled")}var a=t.dbReadyResolve,u=null,o=!1;return S.race([r,(typeof navigator>"u"?S.resolve():Fi()).then(function(){return new S(function(s,c){if(i(),!n)throw new C.MissingAPI;var f=e.name,l=t.autoSchema?n.open(f):n.open(f,Math.round(e.verno*10));if(!l)throw new C.MissingAPI;l.onerror=te(c),l.onblocked=F(e._fireOnBlocked),l.onupgradeneeded=F(function(h){if(u=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=We,u.abort(),l.result.close();var x=n.deleteDatabase(f);x.onsuccess=x.onerror=F(function(){c(new C.NoSuchDatabase("Database "+f+" doesnt exist"))})}else{u.onerror=te(c);var p=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;o=p<1,e._novip.idbdb=l.result,Ai(e,p/10,u,c)}},c),l.onsuccess=F(function(){u=null;var h=e._novip.idbdb=l.result,x=Et(h.objectStoreNames);if(x.length>0)try{var p=h.transaction(gi(x),"readonly");t.autoSchema?ki(e,h,p):(Zt(e,e._dbSchema,p),Ti(e,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),pn(e,p)}catch(d){}je.push(e),h.onversionchange=F(function(d){t.vcFired=!0,e.on("versionchange").fire(d)}),h.onclose=F(function(d){e.on("close").fire(d)}),o&&Bi(e._deps,f),s()},c)})})]).then(function(){return i(),t.onReadyBeingFired=[],S.resolve(en(function(){return e.on.ready.fire(e.vip)})).then(function s(){if(t.onReadyBeingFired.length>0){var c=t.onReadyBeingFired.reduce(cn,B);return t.onReadyBeingFired=[],S.resolve(en(function(){return c(e.vip)})).then(s)}})}).finally(function(){t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(function(){return e}).catch(function(s){t.dbOpenError=s;try{u&&u.abort()}catch(c){}return r===t.openCanceller&&e._close(),L(s)}).finally(function(){t.openComplete=!0,a()})}function tn(e){var t=function(u){return e.next(u)},n=function(u){return e.throw(u)},r=a(t),i=a(n);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?W(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(t)()}function Ni(e,t,n){var r=arguments.length;if(r<2)throw new C.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=Ln(i);return[e,a,n]}function cr(e,t,n,r,i){return S.resolve().then(function(){var a=A.transless||A,u=e._createTransaction(t,n,e._dbSchema,r),o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),e._state.PR1398_maxLoop=3}catch(l){return l.name===sn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return cr(e,t,n,null,i)})):L(l)}var s=un(i);s&&Ie();var c,f=S.follow(function(){if(c=i.call(u,u),c)if(s){var l=ce.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=tn(c))},o);return(c&&typeof c.then=="function"?S.resolve(c).then(function(l){return u.active?l:L(new C.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),L(l)})})}function it(e,t,n){for(var r=W(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Li(e){return P(P({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function u(d,y,_){var m=Ne(d),g=i[m]=i[m]||[],b=d==null?0:typeof d=="string"?1:d.length,v=y>0,w=P(P({},_),{isVirtual:v,keyTail:y,keyLength:b,extractKey:$t(d),unique:!v&&_.unique});if(g.push(w),w.isPrimaryKey||a.push(w),b>1){var K=b===2?d[0]:d.slice(0,b-1);u(K,y+1,_)}return g.sort(function(E,D){return E.keyTail-D.keyTail}),w}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var f=c[s];u(f.keyPath,0,f)}function l(d){var y=i[Ne(d)];return y&&y[0]}function h(d,y){return{type:d.type===1?2:d.type,lower:it(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,y),lowerOpen:!0,upper:it(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,y),upperOpen:!0}}function x(d){var y=d.query.index;return y.isVirtual?P(P({},d),{query:{index:y,range:h(d.query.range,y.keyTail)}}):d}var p=P(P({},n),{schema:P(P({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(d){return n.count(x(d))},query:function(d){return n.query(x(d))},openCursor:function(d){var y=d.query.index,_=y.keyTail,m=y.isVirtual,g=y.keyLength;if(!m)return n.openCursor(d);function b(v){function w(E){E!=null?v.continue(it(E,d.reverse?e.MAX_KEY:e.MIN_KEY,_)):d.unique?v.continue(v.key.slice(0,g).concat(d.reverse?e.MIN_KEY:e.MAX_KEY,_)):v.continue()}var K=Object.create(v,{continue:{value:w},continuePrimaryKey:{value:function(E,D){v.continuePrimaryKey(it(E,e.MAX_KEY,_),D)}},primaryKey:{get:function(){return v.primaryKey}},key:{get:function(){var E=v.key;return g===1?E[0]:E.slice(0,g)}},value:{get:function(){return v.value}}});return K}return n.openCursor(x(d)).then(function(v){return v&&b(v)})}});return p}})}var Vi={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Li};function bn(e,t,n,r){return n=n||{},r=r||"",N(e).forEach(function(i){if(!Q(t,i))n[r+i]=void 0;else{var a=e[i],u=t[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Mt(a),s=Mt(u);o!==s?n[r+i]=t[i]:o==="Object"?bn(a,u,n,r+i+"."):a!==u&&(n[r+i]=t[i])}else a!==u&&(n[r+i]=t[i])}}),N(t).forEach(function(i){Q(e,i)||(n[r+i]=t[i])}),n}function zi(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Wi={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return P(P({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey,i=P(P({},n),{mutate:function(a){var u=A.trans,o=u.table(t).hook,s=o.deleting,c=o.creating,f=o.updating;switch(a.type){case"add":if(c.fire===B)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===B&&f.fire===B)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===B)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===B)break;return u._promise("readwrite",function(){return h(a)},!0)}return n.mutate(a);function l(p){var d=A.trans,y=p.keys||zi(r,p);if(!y)throw new Error("Keys missing");return p=p.type==="add"||p.type==="put"?P(P({},p),{keys:y}):P({},p),p.type!=="delete"&&(p.values=Ot([],p.values,!0)),p.keys&&(p.keys=Ot([],p.keys,!0)),Ui(n,p,y).then(function(_){var m=y.map(function(g,b){var v=_[b],w={onerror:null,onsuccess:null};if(p.type==="delete")s.fire.call(w,g,v,d);else if(p.type==="add"||v===void 0){var K=c.fire.call(w,g,p.values[b],d);g==null&&K!=null&&(g=K,p.keys[b]=g,r.outbound||q(p.values[b],r.keyPath,g))}else{var E=bn(v,p.values[b]),D=f.fire.call(w,E,g,v,d);if(D){var k=p.values[b];Object.keys(D).forEach(function(R){Q(k,R)?k[R]=D[R]:q(k,R,D[R])})}}return w});return n.mutate(p).then(function(g){for(var b=g.failures,v=g.results,w=g.numFailures,K=g.lastResult,E=0;E<y.length;++E){var D=v?v[E]:y[E],k=m[E];D==null?k.onerror&&k.onerror(b[E]):k.onsuccess&&k.onsuccess(p.type==="put"&&_[E]?p.values[E]:D)}return{failures:b,results:v,numFailures:w,lastResult:K}}).catch(function(g){return m.forEach(function(b){return b.onerror&&b.onerror(g)}),Promise.reject(g)})})}function h(p){return x(p.trans,p.range,1e4)}function x(p,d,y){return n.query({trans:p,values:!1,query:{index:r,range:d},limit:y}).then(function(_){var m=_.result;return l({type:"delete",keys:m,trans:p}).then(function(g){return g.numFailures>0?Promise.reject(g.failures[0]):m.length<y?{failures:[],numFailures:0,lastResult:void 0}:x(p,P(P({},d),{lower:m[m.length-1],lowerOpen:!0}),y)})})}}});return i}})}};function Ui(e,t,n){return t.type==="add"?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function lr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)U(t.keys[i],e[a])===0&&(r.push(n?Qe(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch(u){return null}}var Hi={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return P(P({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=lr(r.keys,r.trans._cache,r.cache==="clone");return i?S.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Qe(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},Rt;function _n(e){return!("from"in e)}var ie=function(e,t){if(this)H(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new ie;return e&&"d"in e&&H(n,e),n}};ke(ie.prototype,(Rt={add:function(e){return bt(this,e),this},addKey:function(e){return Ye(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Ye(t,n,n)}),this}},Rt[Ft]=function(){return nn(this)},Rt));function Ye(e,t,n){var r=U(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(_n(e))return H(e,{from:t,to:n,d:1});var i=e.l,a=e.r;if(U(n,e.from)<0)return i?Ye(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},In(e);if(U(t,e.to)>0)return a?Ye(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},In(e);U(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),U(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var u=!e.r;i&&!e.l&&bt(e,i),a&&u&&bt(e,a)}}function bt(e,t){function n(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;Ye(r,a,u),o&&n(r,o),s&&n(r,s)}_n(t)||n(e,t)}function Yi(e,t){var n=nn(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=nn(e),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(U(o.from,i.to)<=0&&U(o.to,i.from)>=0)return!0;U(i.from,o.from)<0?i=(r=n.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function nn(e){var t=_n(e)?null:{s:0,n:e};return{next:function(n){for(var r=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&U(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||U(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function In(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=P({},e),o=e[i];e.from=o.from,e.to=o.to,e[i]=o[i],u[i]=o[a],e[a]=u,u.d=Rn(u)}e.d=Rn(e)}function Rn(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}var Qi={stack:"dbcore",level:0,create:function(e){var t=e.schema.name,n=new ie(e.MIN_KEY,e.MAX_KEY);return P(P({},e),{table:function(r){var i=e.table(r),a=i.schema,u=a.primaryKey,o=u.extractKey,s=u.outbound,c=P(P({},i),{mutate:function(h){var x=h.trans,p=x.mutatedParts||(x.mutatedParts={}),d=function(K){var E="idb://"+t+"/"+r+"/"+K;return p[E]||(p[E]=new ie)},y=d(""),_=d(":dels"),m=h.type,g=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[],b=g[0],v=g[1],w=h.trans._cache;return i.mutate(h).then(function(K){if(W(b)){m!=="delete"&&(b=K.results),y.addKeys(b);var E=lr(b,w);!E&&m!=="add"&&_.addKeys(b),(E||v)&&Xi(d,a,E,v)}else if(b){var D={from:b.lower,to:b.upper};_.add(D),y.add(D)}else y.add(n),_.add(n),a.indexes.forEach(function(k){return d(k.name).add(n)});return K})}}),f=function(h){var x,p,d=h.query,y=d.index,_=d.range;return[y,new ie((x=_.lower)!==null&&x!==void 0?x:e.MIN_KEY,(p=_.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},l={get:function(h){return[u,new ie(h.key)]},getMany:function(h){return[u,new ie().addKeys(h.keys)]},count:f,query:f,openCursor:f};return N(l).forEach(function(h){c[h]=function(x){var p=A.subscr;if(p){var d=function(w){var K="idb://"+t+"/"+r+"/"+w;return p[K]||(p[K]=new ie)},y=d(""),_=d(":dels"),m=l[h](x),g=m[0],b=m[1];if(d(g.name||"").add(b),!g.isPrimaryKey)if(h==="count")_.add(n);else{var v=h==="query"&&s&&x.values&&i.query(P(P({},x),{values:!1}));return i[h].apply(this,arguments).then(function(w){if(h==="query"){if(s&&x.values)return v.then(function(k){var R=k.result;return y.addKeys(R),w});var K=x.values?w.result.map(o):w.result;x.values?y.addKeys(K):_.addKeys(K)}else if(h==="openCursor"){var E=w,D=x.values;return E&&Object.create(E,{key:{get:function(){return _.addKey(E.primaryKey),E.key}},primaryKey:{get:function(){var k=E.primaryKey;return _.addKey(k),k}},value:{get:function(){return D&&y.addKey(E.primaryKey),E.value}}})}return w})}}return i[h].apply(this,arguments)}}),c}})}};function Xi(e,t,n,r){function i(a){var u=e(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&W(c)?c.forEach(function(f){return u.addKey(f)}):u.addKey(c)};(n||r).forEach(function(c,f){var l=n&&o(n[f]),h=r&&o(r[f]);U(l,h)!==0&&(l!=null&&s(l),h!=null&&s(h))})}t.indexes.forEach(i)}var wn=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=P({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:B,dbReadyPromise:null,cancelOpen:B,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};u.dbReadyPromise=new S(function(o){u.dbReadyResolve=o}),u.openCanceller=new S(function(o,s){u.cancelOpen=s}),this._state=u,this.name=t,this.on=Je(this,"populate","blocked","versionchange","close",{ready:[cn,B]}),this.on.ready.subscribe=Mn(this.on.ready.subscribe,function(o){return function(s,c){e.vip(function(){var f=r._state;if(f.openComplete)f.dbOpenError||S.resolve().then(s),c&&o(s);else if(f.onReadyBeingFired)f.onReadyBeingFired.push(s),c&&o(s);else{o(s);var l=r;c||o(function h(){l.on.ready.unsubscribe(s),l.on.ready.unsubscribe(h)})}})}}),this.Collection=ci(this),this.Table=ii(this),this.Transaction=mi(this),this.Version=Ri(this),this.WhereClause=vi(this),this.on("versionchange",function(o){o.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(o){!o.newVersion||o.newVersion<o.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+o.oldVersion/10)}),this._maxKey=He(n.IDBKeyRange),this._createTransaction=function(o,s,c,f){return new r.Transaction(o,s,c,r._options.chromeTransactionDurability,f)},this._fireOnBlocked=function(o){r.on("blocked").fire(o),je.filter(function(s){return s.name===r.name&&s!==r&&!s._state.vcFired}).map(function(s){return s.on("versionchange").fire(o)})},this.use(Vi),this.use(Wi),this.use(Qi),this.use(Hi),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(o){return o(r)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new C.Type("Given version is not a positive number");if(t=Math.round(t*10)/10,this.idbdb||this._state.isBeingOpened)throw new C.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=this._versions,r=n.filter(function(i){return i._cfg.version===t})[0];return r||(r=new this.Version(t),n.push(r),n.sort(Si),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(t){var n=this;return this.idbdb&&(this._state.openComplete||A.letThrough||this._vip)?t():new S(function(r,i){if(n._state.openComplete)return i(new C.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new C.DatabaseClosed);return}n.open().catch(B)}n._state.dbReadyPromise.then(r,i)}).then(t)},e.prototype.use=function(t){var n=t.stack,r=t.create,i=t.level,a=t.name;a&&this.unuse({stack:n,name:a});var u=this._middlewares[n]||(this._middlewares[n]=[]);return u.push({stack:n,create:r,level:i==null?10:i,name:a}),u.sort(function(o,s){return o.level-s.level}),this},e.prototype.unuse=function(t){var n=t.stack,r=t.name,i=t.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},e.prototype.open=function(){return ji(this)},e.prototype._close=function(){var t=this._state,n=je.indexOf(this);if(n>=0&&je.splice(n,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}t.dbReadyPromise=new S(function(r){t.dbReadyResolve=r}),t.openCanceller=new S(function(r,i){t.cancelOpen=i})},e.prototype.close=function(){this._close();var t=this._state;this._options.autoOpen=!1,t.dbOpenError=new C.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)},e.prototype.delete=function(){var t=this,n=arguments.length>0,r=this._state;return new S(function(i,a){var u=function(){t.close();var o=t._deps.indexedDB.deleteDatabase(t.name);o.onsuccess=F(function(){Mi(t._deps,t.name),i()}),o.onerror=te(a),o.onblocked=t._fireOnBlocked};if(n)throw new C.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return N(this._allTables).map(function(n){return t._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var t=Ni.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,n,r){var i=this,a=A.trans;(!a||a.db!==this||t.indexOf("!")!==-1)&&(a=null);var u=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");var o,s;try{if(s=n.map(function(f){var l=f instanceof i.Table?f.name:f;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),t=="r"||t===Ct)o=Ct;else if(t=="rw"||t==kt)o=kt;else throw new C.InvalidArgument("Invalid transaction mode: "+t);if(a){if(a.mode===Ct&&o===kt)if(u)a=null;else throw new C.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(f){if(a&&a.storeNames.indexOf(f)===-1)if(u)a=null;else throw new C.SubTransaction("Table "+f+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(f){return a?a._promise(null,function(l,h){h(f)}):L(f)}var c=cr.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):A.trans?Re(A.transless,function(){return i._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(t){if(!Q(this._allTables,t))throw new C.InvalidTable("Table "+t+" does not exist");return this._allTables[t]},e}(),Gi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",$i=function(){function e(t){this._subscribe=t}return e.prototype.subscribe=function(t,n,r){return this._subscribe(!t||typeof t=="function"?{next:t,error:n,complete:r}:t)},e.prototype[Gi]=function(){return this},e}();function fr(e,t){return N(t).forEach(function(n){var r=e[n]||(e[n]=new ie);bt(r,t[n])}),e}function Ji(e){var t=!1,n=void 0,r=new $i(function(i){var a=un(e);function u(y){a&&Ie();var _=function(){return ve(e,{subscr:y,trans:null})},m=A.trans?Re(A.transless,_):_();return a&&m.then(ce,ce),m}var o=!1,s={},c={},f={get closed(){return o},unsubscribe:function(){o=!0,me.storagemutated.unsubscribe(p)}};i.start&&i.start(f);var l=!1,h=!1;function x(){return N(c).some(function(y){return s[y]&&Yi(s[y],c[y])})}var p=function(y){fr(s,y),x()&&d()},d=function(){if(!(l||o)){s={};var y={},_=u(y);h||(me(Ue,p),h=!0),l=!0,Promise.resolve(_).then(function(m){t=!0,n=m,l=!1,!o&&(x()?d():(s={},c=y,i.next&&i.next(m)))},function(m){l=!1,t=!1,i.error&&i.error(m),f.unsubscribe()})}};return d(),f});return r.hasValue=function(){return t},r.getValue=function(){return n},r}var rn;try{rn={indexedDB:M.indexedDB||M.mozIndexedDB||M.webkitIndexedDB||M.msIndexedDB,IDBKeyRange:M.IDBKeyRange||M.webkitIDBKeyRange}}catch(e){rn={indexedDB:null,IDBKeyRange:null}}var ge=wn;ke(ge,P(P({},St),{delete:function(e){var t=new ge(e,{addons:[]});return t.delete()},exists:function(e){return new ge(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return Oi(ge.dependencies).then(e)}catch(t){return L(new C.MissingAPI)}},defineClass:function(){function e(t){H(this,t)}return e},ignoreTransaction:function(e){return A.trans?Re(A.transless,e):e()},vip:en,async:function(e){return function(){try{var t=tn(e.apply(this,arguments));return!t||typeof t.then!="function"?S.resolve(t):t}catch(n){return L(n)}}},spawn:function(e,t,n){try{var r=tn(e.apply(n,t||[]));return!r||typeof r.then!="function"?S.resolve(r):r}catch(i){return L(i)}},currentTransaction:{get:function(){return A.trans||null}},waitFor:function(e,t){var n=S.resolve(typeof e=="function"?ge.ignoreTransaction(e):e).timeout(t||6e4);return A.trans?A.trans.waitFor(n):n},Promise:S,debug:{get:function(){return ne},set:function(e){zn(e,e==="dexie"?function(){return!0}:nr)}},derive:Te,extend:H,props:ke,override:Mn,Events:Je,on:me,liveQuery:Ji,extendObservabilitySet:fr,getByKeyPath:oe,setByKeyPath:q,delByKeyPath:kr,shallowClone:Nn,deepClone:Qe,getObjectDiff:bn,cmp:U,asap:Fn,minKey:Xt,addons:[],connections:je,errnames:sn,dependencies:rn,semVer:Kn,version:Kn.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,n*2)})}));ge.maxKey=He(ge.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(me(Ue,function(e){if(!ue){var t;At?(t=document.createEvent("CustomEvent"),t.initCustomEvent(pe,!0,!0,e)):t=new CustomEvent(pe,{detail:e}),ue=!0,dispatchEvent(t),ue=!1}}),addEventListener(pe,function(e){var t=e.detail;ue||_t(t)}));function _t(e){var t=ue;try{ue=!0,me.storagemutated.fire(e)}finally{ue=t}}var ue=!1;if(typeof BroadcastChannel<"u"){var at=new BroadcastChannel(pe);typeof at.unref=="function"&&at.unref(),me(Ue,function(e){ue||at.postMessage(e)}),at.onmessage=function(e){e.data&&_t(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){me(Ue,function(e){try{ue||(typeof localStorage<"u"&&localStorage.setItem(pe,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&Ot([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(t){return t.postMessage({type:pe,changedParts:e})}))}catch(t){}}),typeof addEventListener<"u"&&addEventListener("storage",function(e){if(e.key===pe){var t=JSON.parse(e.newValue);t&&_t(t.changedParts)}});var On=self.document&&navigator.serviceWorker;On&&On.addEventListener("message",qi)}function qi(e){var t=e.data;t&&t.type===pe&&_t(t.changedParts)}S.rejectionMapper=jr;zn(ne,nr);const j=new wn("lowCode"),Zi=8;j.version(Zi).stores({projects:"++id, name, code, desc, *theme",dataSystem:"++id, projectId, field, fn, method, url, callback, pageId, init",pages:"++id, projectId, code, name, isHome, notes",dataSource:"++id, projectId, pageId, [projectId+pageId], *dataSource, *events, *fields",externals:"++id, projectId, url, name, type",theme:"++id, projectId, *dataSource"});const ea=e=>j.projects.add(e),ta=e=>j.projects.where(e).first(),na=()=>j.projects.toArray(),ra=(e,t)=>j.projects.update(e,t),ia=async e=>(hr({projectId:e}).then(t=>{var r;const n=(r=t==null?void 0:t.map(i=>i.id))!=null?r:[];n!=null&&n.length&&dr(n)}),pr({projectId:e}).then(t=>{var r;const n=(r=t==null?void 0:t.map(i=>i.id))!=null?r:[];n!=null&&n.length&&vr(n)}),yr({projectId:e}).then(t=>{var r;const n=(r=t==null?void 0:t.map(i=>i.id))!=null?r:[];n!=null&&n.length&&gr(n)}),j.projects.delete(e)),aa=e=>j.pages.add(e),ua=(e,t)=>j.pages.update(e,t),hr=e=>j.pages.where(e).toArray(),oa=async e=>(mr(e),j.pages.delete(e)),dr=e=>j.pages.bulkDelete(e),sa=e=>j.dataSystem.add(e),pr=e=>j.dataSystem.where(e).toArray(),ca=(e,t)=>j.dataSystem.update(e,t),la=e=>j.dataSystem.delete(e),vr=e=>j.dataSystem.bulkDelete(e),fa=e=>j.dataSource.put(e),ha=e=>j.dataSource.where(e).first(),yr=e=>j.dataSource.where(e).toArray(),mr=e=>j.dataSource.delete(e),gr=e=>j.dataSource.bulkDelete(e),da=e=>j.externals.add(e),pa=e=>j.externals.delete(e),va=e=>j.externals.where(e).toArray(),ya=Object.freeze(Object.defineProperty({__proto__:null,addProject:ea,getProject:ta,getProjects:na,updateProject:ra,deleteProject:ia,addPage:aa,updatePages:ua,getPages:hr,deletePage:oa,deletePageBatch:dr,addDataSystem:sa,getDataSystem:pr,updateDataSystem:ca,delteDataSystem:la,deleteDataSystemBatch:vr,setDataSource:fa,getDataSource:ha,getDataSourceBatch:yr,deleteDataSource:mr,deleteDataSourceBatch:gr,addExternals:da,deleteExternals:pa,getExternals:va},Symbol.toStringTag,{value:"Module"})),ga={operateApis:Sr,dataApis:ya};export{ga as a};
